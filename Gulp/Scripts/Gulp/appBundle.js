var RemesasSearch={},jsonData={},nombre=$("#idNombre"),ap_paterno=$("#idApPaternoBitacora"),ap_materno=$("#idApMaternoBitacora"),tblCasos=$("#tblBitacoraCasos"),btnBuscarBitacora=$("#btnBuscarBitacora"),getInfo=$("#info"),idInvt=$("#IdInvestigacionAlerta"),Consulta="",Row="";RemesasSearch.Init=function(){btnBuscarBitacora.click(function(){RemesasSearch.ConsultaCasos()})},RemesasSearch.ConsultaCasos=function(){if(""==nombre.val())return nombre.focus(),ModalDialogMdl.HideLoading(),void notie.alert({type:3,text:"Ingresa un Nombre",position:"bottom"});jsonData.Nombre=nombre.val(),jsonData.ApellidoP=ap_paterno.val(),jsonData.ApellidoM=ap_materno.val(),Consulta=RemesasSearch.ConsultasAjax("GetCasos",JSON.stringify(jsonData)),$("#"+$(tblCasos).attr("id")+" tbody tr").remove();var a="",o=["NombreCliente","NombreAlerta","Estatus","FechaAlta","TotalTransacciones"];if(0<Consulta.length){for(var s=0;s<Consulta.length;s++)a+="<tr>",a+='<td style="text-align: center;"><div class="material-icons modal-TranSospechosa" id= "'+s+'" ><i class="material-icons mdl-color-text--indigo">&#xE8B6;</i></div> <div class="mdl-tooltip" data-mdl-for="'+s+'">Detalles</div> </td > ',$.each(Consulta[s],function(t,e){0==Consulta[s].Estatus?Consulta[s].Estatus="En proceso":Consulta[s].Estatus,0<=o.indexOf(t)&&(a+='<td style="text-align: center;">'+e+"</td>")}),a+="</tr>";$("#"+$(tblCasos).attr("id")+" tbody").append(a),$(".modal-TranSospechosa").click(function(){ModalDialogMdl.ShowLoading();var t=$(this).attr("id");setTimeout(function(){RemesasSearch.ModalBitacoraCasos(t)},600)}),ModalDialogMdl.HideLoading()}else notie.alert({type:"success",text:"No existen registros.",position:"bottom"})},RemesasSearch.ModalBitacoraCasos=function(t){Row=t;var e=GetHTML("DetailsCasos","");ModalDialogMdl.HideLoading(),ModalDialogMdl.InfoModal(e,'<div style="text-align:center;">Investigaci√≥n</div>',"True"),$("#orrsDiag_content p").remove(),ModalDialogMdl.HideLoading()},RemesasSearch.ConsultasAjax=function(t,e){var a="";return $.ajaxSetup({url:t,type:"POST",global:!1,beforeSend:function(){ModalDialogMdl.ShowLoading()},complete:function(){ModalDialogMdl.HideLoading()},error:function(){notie.alert({type:3,text:"No se puede procesar la solicitud",position:"bottom"})}}),$.ajax({data:e,dataType:"json",contentType:"application/json; charset=utf-8",async:!1,success:function(t){a=t}}),a},RemesasSearch.GetCasos=function(t,e,a){$.ajaxSetup({url:"GetCasos",type:"POST",global:!1,beforeSend:function(){ModalDialogMdl.ShowLoading()},complete:function(){ModalDialogMdl.HideLoading()},error:function(){notie.alert({type:3,text:"No se puede procesar la solicitud",position:"bottom"})}}),$.ajax({dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({Nombre:t,ApellidoP:e,ApellidoM:a}),success:function(t){0<t.length?($(".registros").remove(),$.each(t,function(t,e){var a="<button id='"+e.IdInvestigacionAlerta+"_"+e.IdCliente+"' class='mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-color--amber-900 mdl-color-text--grey-50 registros'>Detalles</button>",o="<tr>";o+="<td>"+e.NombreCliente+"</td>",o+="<td>"+e.ApPaternoCliente+"</td>",o+="<td>"+e.ApMaternoCliente+"</td>",o+="<td>"+e.NombreAlerta+"</td>",o+="<td>"+e.Estatus+"</td>",o+="<td hidden>"+e.NumeroIdentificaciones+"</td>",o+="<td hidden>"+e.Identificaciones+"</td>",o+="<td hidden>"+e.NumeroDirecciones+"</td>",o+="<td hidden>"+e.Domicilios+"</td>",o+="<td hidden>"+e.TotalTransacciones+"</td>",o+="<td hidden>"+e.ImporteMinimo+"</td>",o+="<td hidden>"+e.ImporteMaximo+"</td>",o+="<td hidden>"+e.Destinos+"</td>",o+="<td hidden>"+e.MontoAcumulado+"</td>",o+="<td hidden>"+e.NumeroSucursales+"</td>",o+="<td hidden>"+e.OcupacionCliente+"</td>",o+="<td hidden>"+e.Transmisores+"</td>",o+="<td hidden>"+e.Pagadores+"</td>",o+="<td>"+e.FechaActualizacion+"</td>",o+="<td hidden>"+e.UsuarioActualiza+"</td>",o+="<td hidden>"+e.Campo41+"</td>",o+="<td hidden>"+e.ReferenciasInternet+"</td>",o+="<td hidden>"+e.PersonasRelacionadas+"</td>",o+="<td hidden>"+e.Justificacion+"</td>",o+="<td>"+e.FechaAlta+"</td>",o+="<td>"+a+"</td>",o+="</tr>",$("#tblGridBitacoras").append(o)}),Remesas.CrearExcel(text)):notie.alert({type:"error",text:"No existen registros",position:"bottom"})}})},RemesasSearch.EventoClick=function(t){ModalDialogMdl.ShowLoading(),window.location.href="DetalleAlerta?IdInvestigacionAlerta="+t},RemesasSearch.ObtenerInformacionCaso=function(){$.each(Consulta[Row],function(t,e){$("#ModalDetallesCaso * #"+t).text(null==e||"null"==e||""==e?"N/A":e)})},RemesasSearch.ValidateControlls=function(){$("#idNombre").keyup(function(){$(this).val($(this).val().toUpperCase())}),$("#idApPaternoBitacora").keyup(function(){$(this).val($(this).val().toUpperCase())}),$("#idApMaternoBitacora").keyup(function(){$(this).val($(this).val().toUpperCase())})};var RemesasCaso={},tblPropC=(jsonData={},$("#tblCasos")),tblAlertas=$("#tblGridDatos"),divCN=$("#cnbv"),btnGinfo=$("#btnGuardarInfo"),btnCancelar=$("#btnCancelar"),txtJustificacion=$("#Justificacion"),txtCampo41=$("#TxtCampo41"),chckCNV=$("#checkCNBV"),chckComite=$("#checkComite"),idInvestigacion=$("#IdInvestigacion"),btnPrestComit=$("#btnPresentaComite"),btnGeneraReport=$("#btnGenertCNVB"),checkComite=$("#Comite"),aBtnPresentar=$("#aPresentarComite"),aBtnReporteCNVB=$("#aGenerarReporte"),txBuscarCasos=$("#txtBuscarCasos"),result="";Row="",Consulta="";RemesasCaso.Init=function(){RemesasCaso.LoadAlertas(),$("#btnFiltrar").click(function(){$("#tblGridDatos").find("tr:not(:first)").remove(),RemesasCaso.BuscaInvestigacionAlerta(parseInt($("#IdAlerta").val()),$("#IdAlerta option:selected").text())}),$(document).on("click",".registros",function(t){t.preventDefault();var e=t.target.id.split("_");ModalDialogMdl.ShowLoading(),window.location.href="DetalleAlerta?IdInvestigacionAlerta="+e[0]})},RemesasCaso.GetTxtC=function(){var t=new XMLHttpRequest;t.open("Post","BuildReport",!0),t.responseType="blob",t.onreadystatechange=function(){if(4==this.readyState){var t=new Blob([this.response],{type:"application/octet-stream"});saveAs(t,"Cumplimiento.zip"),RemesasCaso.Casos()}},t.send(null)},RemesasCaso.LoadAlertas=function(){$.get("ConfiguracionToList").done(function(t){0<t.datos.length?$.each(t.datos,function(t,e){var a='<option id="Alerta'+e.IdConfiguracionAlerta+'" value = "'+e.IdConfiguracionAlerta+'">'+e.NombreAlerta+"</option>";$("#IdAlerta").append(a)}):$("#IdAlerta").empty().append($("<option>",{value:"",text:"No existen Redes.."}))})},RemesasCaso.BuscaInvestigacionAlerta=function(t,e){jsonData.IdConfiguracionAlerta=t,Consulta=ConsultasAjax("InvestigacionAlertaTolist",JSON.stringify(jsonData)).datos,$("#"+$(tblAlertas).attr("id")+" tbody tr").remove();var a="";if(0<Consulta.length){for(var o=0;o<Consulta.length;o++)a+="<tr>",$.each(Consulta[o],function(t,e){a+="IdConfiguracionAlerta"==t||"IdCliente"==t||"IdInvestigacionAlerta"==t?"<td hidden>"+e+"</td>":'<td style="text-align:center;">'+e+"</td>"}),a+="<td><button id='"+Consulta[o].IdInvestigacionAlerta+"_"+Consulta[o].IdCliente+"' class='mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-color--amber-900 mdl-color-text--grey-50 registros'>Detalles</button></td>",a+="</tr>";$("#"+$(tblAlertas).attr("id")+" tbody").append(a),RemesasCumplimiento.CreateExcel("#tblGridDatos",e)}else notie.alert({type:"success",text:"No existen registros.",position:"bottom"})},RemesasCaso.Casos=function(){componentHandler.upgradeDom(),txBuscarCasos.keyup(function(){var t,e,a;for(t=$(this).val().toUpperCase(),e=$("#tblCasos").get(0).getElementsByTagName("tr"),a=0;a<e.length;a++)for(var o=0;o<e[a].getElementsByTagName("td").length;o++){var s;if(s=e[a].getElementsByTagName("td")[o]){if(1<s.innerHTML.toUpperCase().indexOf(t)||-1<s.innerHTML.toUpperCase().indexOf(t)){e[a].style.display="";break}e[a].style.display="none"}}}),btnPrestComit.click(function(){ConsultasAjax("Processing")}),RemesasCaso.ValidateButtonsEnd(),RemesasCaso.ValidateVisbleReport(),btnGeneraReport.click(function(){RemesasCaso.GetTxtC(),RemesasCaso.ValidateButtonsEnd(),RemesasCaso.ValidateVisbleReport()}),aBtnPresentar.click(function(t){document.getElementById("hiddenDownloader").src="PPTC"}),Consulta=ConsultasAjax("GetPostProp",""),$("#"+$(tblPropC).attr("id")+" tbody tr").remove();var a="",o=["Estatus","NombreCliente","NombreAlerta","FechaAlta","TipoReporte","Asignacion"];if(0<Consulta.length){for(var s=0;s<Consulta.length;s++){a+="<tr>";var i='<div style="text-align:left" id="'+Consulta[s].IdInvestigacionAlerta+'" class="link-wrapper casos view-message text-right inbox-small-cells"> <i style="position:relative;top: 5px; left:5px;" class="material-icons">account_box</i><span><a class="link hover-2 mdl-color-text--black" style="width:15%;">  '+Consulta[s].NombreCliente+'</a></span><span class="taille"></span></div>',n='<div style="text-align:left" id="'+Consulta[s].IdInvestigacionAlerta+'" class="link-wrapper casos view-message text-right inbox-small-cells"><i style="position:relative;top: 5px; left:5px;" class="material-icons">&#xE156;</i><a class="link hover-2 mdl-color-text--black" style="width:15%;">  '+Consulta[s].NombreAlerta+'</a></span><span class="taille"></span></div>',t="<td style='text-align:center'><div><label class='mdl-switch mdl-js-switch mdl-js-ripple-effect' for='switch-"+Consulta[s].IdInvestigacionAlerta+"' style='width:15%;'><input type='checkbox' id='switch-"+Consulta[s].IdInvestigacionAlerta+"' "+(1==Consulta[s].Estatus?"checked":"")+" class='mdl-switch__input' /><span class='mdl-switch__label'></span></label></div></td>",e='<td style="text-align: center;"><div class="material-icons modal-PropCasos mdl-color-text--indigo" id= "'+Consulta[s].IdInvestigacionAlerta+'" >&#xE929;</div><div class="mdl-tooltip" data-mdl-for="'+Consulta[s].IdInvestigacionAlerta+'">Clic para actualizar</div> </td > ';$.each(Consulta[s],function(t,e){0<=o.indexOf(t)&&(a+="NombreCliente"==t?'<td style="text-align: center;">'+i+"</td>":"NombreAlerta"==t?'<td style="text-align: center;">'+n+"</td>":"Campo41"==t?'<td id="'+Consulta[s].Campo41+'" style="text-align: center;" class="campo41">'+e+"</td>":"Justificacion"==t?'<td id="justificacion" style="text-align: center;" class="justificacion">'+js+"</td>":'<td style="text-align: center;">'+e+"</td>")}),"En comite"==Consulta[s].Estatus?($(document).find("#idReportar").show(),a+=e,a+=t):a+='<td style="text-align: center;"></td >',a+="</tr>"}$("#"+$(tblPropC).attr("id")+" tbody").append(a),$(".mdl-switch").change(function(){jsonData.id=$(this).children("[type=checkbox]").attr("id").split("-")[1],ConsultasAjax("ReportarCasoCN",JSON.stringify(jsonData)),RemesasCaso.ValidateVisbleReport()}),$(".modal-PropCasos").click(function(){ModalDialogMdl.ShowLoading();var t=$(this).attr("id");setTimeout(function(){RemesasCaso.ModalTCasos(t)},600)}),ModalDialogMdl.HideLoading(),$(document).on("click",".casos",function(t){t.preventDefault();var e=$(this).closest(".casos").attr("id");ModalDialogMdl.ShowLoading(),window.location.href="DetailsCase?IdInvestigacionAlerta="+e})}else notie.alert({type:"success",text:"No existen registros.",position:"bottom"})},RemesasCaso.ModalTCasos=function(t){var e="<input type='hidden' id='IdInvestigacion' value='"+(Row=t)+'\' /><br/><div style="text-align:center;">Editar Caso</div>',a=GetHTML("RemEditCaso");ModalDialogMdl.HideLoading(),ModalDialogMdl.InfoModal(a,e,null),$("#orrsDiag_content p").remove(),ModalDialogMdl.HideLoading()},RemesasCaso.ValidateButtonsEnd=function(){1==ConsultasAjax("VerifyBtnPresenta").CodeResult?aBtnPresentar.show():aBtnPresentar.hide()},RemesasCaso.ValidateVisbleReport=function(){1==ConsultasAjax("VerifyBtnReport").CodeResult?aBtnReporteCNVB.show():aBtnReporteCNVB.hide()},RemesasCaso.InitCaso=function(){RemesasCaso.GetJustificacion(idInvestigacion.val()),btnCancelar.click(function(){ModalDialogMdl.HideDialog($("#orrsDiag"))}),btnGinfo.click(function(){jsonData.id=idInvestigacion.val(),jsonData.justificacion=txtJustificacion.val(),jsonData.banderaComite=1==checkComite.is(":checked")?1:0,1==(result=ConsultasAjax("ChangeStatusC",JSON.stringify(jsonData))).CodeResult||2==result.CodeResult||3==result.CodeResult?notie.alert({type:"success",text:result.MessageResult,position:"bottom"}):notie.alert({type:"error",text:result.MessageResult,position:"bottom"}),ModalDialogMdl.HideDialog($("#orrsDiag"))})},RemesasCaso.GetJustificacion=function(t){jsonData.id=t;var e=ConsultasAjax("DetlsCase",JSON.stringify(jsonData));$.each(e,function(t,e){"Comite"==t&&1==e&&$("#"+t).attr("checked","checked"),$("#"+t).val(e)}),$(".mdl-switch").change(function(){1==checkComite.val()&&(jsonData.IdInvestigacion=t,jsonData.Justificacion=txtJustificacion.val(),jsonData.Comite=0,1==ConsultasAjax("FinalizarInvPost",JSON.stringify(jsonData))?(notie.alert({type:"success",text:"El caso se ha cerrado exitosamente por falta de inusualidad.",position:"bottom"}),ModalDialogMdl.HideDialog($("#orrsDiag")),componentHandler.upgradeDom(),RemesasCaso.Casos(),componentHandler.upgradeDom()):notie.alert({type:"error",text:"No se puede procesar solicitud.",position:"bottom"}))})};